/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{433:function(Ca,va,r){r.r(va);var oa=r(1),la=r(13),ka=r(2);Ca=r(52);var ha=r(31),da=r(10);r=function(){function z(){this.init()}z.prototype.init=function(){this.S2=!1;this.Ze=this.Ak=this.connection=null;this.Qq={};this.ja=this.JD=null};z.prototype.Zha=function(w){for(var x=this,f=0;f<w.length;++f){var a=w[f];switch(a.at){case "create":this.Qq[a.author]||(this.Qq[a.author]=a.aName);this.m$(a);break;case "modify":this.ja.$k(a.xfdf).then(function(b){x.ja.eb(b[0])});
break;case "delete":this.ja.$k("<delete><id>"+a.aId+"</id></delete>")}}};z.prototype.m$=function(w){var x=this;this.ja.$k(w.xfdf).then(function(f){f=f[0];f.authorId=w.author;x.ja.eb(f);x.ja.trigger(la.a.UPDATE_ANNOTATION_PERMISSION,[f])})};z.prototype.M9=function(w,x,f){this.Ak&&this.Ak(w,x,f)};z.prototype.preloadAnnotations=function(w){this.addEventListener("webViewerServerAnnotationsEnabled",this.M9.bind(this,w,"add",{imported:!1}),{once:!0})};z.prototype.initiateCollaboration=function(w,x,f){var a=
this;if(w){a.Ze=x;a.ja=f.pa();f.addEventListener(la.c.DOCUMENT_UNLOADED,function(){a.disableCollaboration()});a.wia(w);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var e=JSON.parse(b.responseText);a.connection=exports.Sa.Yia(Object(ha.j)(a.Ze,"blackbox/"),"annot");a.JD=e.id;a.Qq[e.id]=e.user_name;a.ja.pK(e.id);a.connection.SK(function(n){n.t&&n.t.startsWith("a_")&&n.data&&a.Zha(n.data)},function(){a.connection.send({t:"a_retrieve",dId:w});
a.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[a.Qq[e.id],a.JD])},function(){a.disableCollaboration()})}catch(n){Object(ka.g)(n.message)}});b.open("GET",Object(ha.j)(this.Ze,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();a.S2=!0;a.ja.JV(function(e){return a.Qq[e.Author]||e.Author})}else Object(ka.g)("Document ID required for collaboration")};z.prototype.disableCollaboration=function(){this.Ak&&(this.ja.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Ak),this.Ak=null);this.connection&&
this.connection.EG();this.ja&&this.ja.pK("Guest");this.init();this.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};z.prototype.wia=function(w){var x=this;this.Ak&&this.ja.removeEventListener(da.a.Events.ANNOTATION_CHANGED,this.Ak);this.Ak=function(f,a,b){return Object(oa.b)(this,void 0,void 0,function(){var e,n,h,ba,y,aa,fa,ca,ea;return Object(oa.d)(this,function(ia){switch(ia.label){case 0:if(b.imported)return[2];e={t:"a_"+a,dId:w,annots:[]};return[4,x.ja.KG()];case 1:n=ia.ea();"delete"!==
a&&(h=(new DOMParser).parseFromString(n,"text/xml"),ba=new XMLSerializer);for(y=0;y<f.length;y++)aa=f[y],ca=fa=void 0,"add"===a?(fa=h.querySelector('[name="'+aa.Id+'"]'),ca=ba.serializeToString(fa),ea=null,aa.InReplyTo&&(ea=x.ja.If(aa.InReplyTo).authorId||"default"),e.annots.push({at:"create",aId:aa.Id,author:x.JD,aName:x.Qq[x.JD],parent:ea,xfdf:"<add>"+ca+"</add>"})):"modify"===a?(fa=h.querySelector('[name="'+aa.Id+'"]'),ca=ba.serializeToString(fa),e.annots.push({at:"modify",aId:aa.Id,xfdf:"<modify>"+
ca+"</modify>"})):"delete"===a&&e.annots.push({at:"delete",aId:aa.Id});0<e.annots.length&&x.connection.send(e);return[2]}})})}.bind(x);this.ja.addEventListener(da.a.Events.ANNOTATION_CHANGED,this.Ak)};z.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return z}();Object(Ca.a)(r);va["default"]=r}}]);}).call(this || window)
